<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

            <link rel="manifest" href="../../site.webmanifest"/>
            
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-53HJHD1BWS"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-53HJHD1BWS');
    </script>
    
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Running tests &mdash; tardis</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=fd3f3429" />
      <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />

  
    <link rel="shortcut icon" href="../../_static/tardis_logo.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/ServiceHandler.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link href="../../_static/tardis.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            tardis
          </a>
              <div class="version">
                latest
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">Running tests</a><ul>
<li><a class="reference internal" href="#running-the-unit-tests">Running the Unit Tests</a></li>
<li><a class="reference internal" href="#generating-plasma-reference">Generating Plasma Reference</a></li>
<li><a class="reference internal" href="#running-the-integration-tests">Running the Integration Tests</a></li>
</ul>
</li>
</ul>
</div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">tardis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Running tests</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/contributing/development/running_tests.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="running-tests">
<span id="id1"></span><h1>Running tests<a class="headerlink" href="#running-tests" title="Link to this heading">¶</a></h1>
<p>In TARDIS, we focus primarily on unit tests. These tests check the outputs of individual functions, ensuring that each component behaves as expected.</p>
<p>Unit tests run quickly and are executed after every suggested change to TARDIS, allowing for immediate feedback and maintaining code quality.</p>
<p>All of them are based on the excellent <code class="docutils literal notranslate"><span class="pre">astropy-setup-helpers</span></code> package and
<a class="reference external" href="https://docs.pytest.org/en/latest/">pytest</a>.</p>
<section id="running-the-unit-tests">
<h2>Running the Unit Tests<a class="headerlink" href="#running-the-unit-tests" title="Link to this heading">¶</a></h2>
<p>This is very straightforward to run on your own machine. For very simple unit
tests, you can run this with:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>&gt;<span class="w"> </span>pytest<span class="w"> </span>tardis
</pre></div>
</div>
<p>Running the more advanced unit tests requires TARDIS Reference data that can be
downloaded
(<a class="reference external" href="https://github.com/tardis-sn/tardis-refdata">tardis-refdata</a>).
<a class="reference external" href="https://www.atlassian.com/git/tutorials/git-lfs">Git LFS</a> is used
to download the large refdata files in the tardis-refdata repository.</p>
<p>However, it is not required to download the entire repository. Firstly it is
important to identify the refdata files that are needed. Sometimes, it is possible
that a preused fixture that is also being used in the current tests is using some
refdata. So, it is advised to check for such cases beforehand.</p>
<p>After identifying the refdata files to be used in the unit tests, those particular
files can be downloaded using <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">lfs</span></code></p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>&gt;<span class="w"> </span>git<span class="w"> </span>lfs<span class="w"> </span>pull<span class="w"> </span>--include<span class="o">=</span>filename
</pre></div>
</div>
<p>It is important to maintain the same directory structure as the tardis-refdata repo
i.e. the lfs files should be in the same directory tree exactly as in tardis-refdata
repository.</p>
<p>Finally, the tests can be run using the following command</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>&gt;<span class="w"> </span>pytest<span class="w"> </span>tardis<span class="w"> </span>--tardis-refdata<span class="o">=</span>/path/to/tardis-refdata/
</pre></div>
</div>
<p>Or, to run tests for a particular file or directory</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>&gt;<span class="w"> </span>pytest<span class="w"> </span>tardis/path/to/test_file_or_directory<span class="w"> </span>--tardis-refdata<span class="o">=</span>/path/to/tardis-refdata/
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <a class="reference external" href="https://github.com/tardis-sn/tardis/blob/master/.github/workflows/tests.yml">tests workflow</a> runs on
<a class="reference external" href="https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#pull_request">pull requests</a> and on
<a class="reference external" href="https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#push">push</a> events.
To prevent leaking LFS quota, tests have been disabled on forks.
If, by any chance, you need to run tests on your fork, make sure to run the tests workflow on master branch first.
The LFS cache generated in the master branch should be available in all child branches.
You can check if cache was generated by looking in the <code class="docutils literal notranslate"><span class="pre">Restore</span> <span class="pre">LFS</span> <span class="pre">Cache</span></code> step of the workflow run.
Cache can also be found under the “Management” Section under “Actions” tab.</p>
</div>
</section>
<section id="generating-plasma-reference">
<h2>Generating Plasma Reference<a class="headerlink" href="#generating-plasma-reference" title="Link to this heading">¶</a></h2>
<p>You can generate Plasma Reference by the following command:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>&gt;<span class="w"> </span>pytest<span class="w"> </span>-rs<span class="w"> </span>tardis/plasma/tests/test_complete_plasmas.py
--tardis-refdata<span class="o">=</span><span class="s2">&quot;/path/to/tardis-refdata/&quot;</span><span class="w"> </span>--generate-reference
</pre></div>
</div>
</section>
<section id="running-the-integration-tests">
<h2>Running the Integration Tests<a class="headerlink" href="#running-the-integration-tests" title="Link to this heading">¶</a></h2>
<p>These tests require reference files against which the results of the various
tardis runs are tested. So you first need to either download the current
reference files (<a class="reference external" href="https://github.com/tardis-sn/tardis-refdata">here</a>)
or generate new ones.</p>
<p>Both of these require a configuration file for the integration tests:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">atom_data_path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;~/projects/tardis/integration/&quot;</span>

<span class="c1"># Path to directory where reference HDF files will be generated and</span>
<span class="c1"># saved during the test run. Use &quot;--generate-reference&quot; flag in command</span>
<span class="c1"># line args for the purpose, for other cases this will denote path</span>
<span class="c1"># to the directory containing reference HDF files.</span>
<span class="nt">reference</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;~/projects/tardis/integration/&quot;</span>


<span class="c1"># Speeds up test execution by reducing amount of packets per iteration,</span>
<span class="c1"># useful for debugging problems in testing infrastructure itself.</span>
<span class="c1"># Use &quot;--less-packets&quot; in command line args, for other cases this will be</span>
<span class="c1"># simply ignored. This section is not mandatory.</span>
<span class="nt">less_packets</span><span class="p">:</span>
<span class="w">  </span><span class="nt">no_of_packets</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">400</span>
<span class="w">  </span><span class="nt">last_no_of_packets</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
</pre></div>
</div>
<p>Inside the atomic data directory there needs to be atomic data for each of
the setups that are provided in the <code class="docutils literal notranslate"><span class="pre">test_integration</span></code> folder.
If no references are given, the first step is to generate them.
The <code class="docutils literal notranslate"><span class="pre">--less-packets</span></code> option is useful for debugging purposes and will just
use very few packets to generate the references and thus make the process much
faster — THIS IS ONLY FOR DEBUGGING PURPOSES. The <code class="docutils literal notranslate"><span class="pre">-s</span></code> option ensures that
TARDIS prints out the progress:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>&gt;<span class="w"> </span>pytest<span class="w"> </span>--integration<span class="o">=</span>integration.yml<span class="w"> </span>-m<span class="w"> </span>integration<span class="w"> </span>--generate-reference<span class="w"> </span>--less-packets
</pre></div>
</div>
<p>To run the test after having run the <code class="docutils literal notranslate"><span class="pre">--generate-references</span></code>, all that is
needed is:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>&gt;<span class="w"> </span>pytest<span class="w"> </span>--integration<span class="o">=</span>integration.yml<span class="w"> </span>-m<span class="w"> </span>integration<span class="w"> </span>--less-packets<span class="w"> </span>--remote-data
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2013-2024, TARDIS Collaboration.
      <span class="lastupdated">Last updated on 11 Nov 2024.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>